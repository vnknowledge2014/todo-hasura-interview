{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/events/todo_item_updated/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { Application, Request, Response } from \"express\";\nimport { AuditLogDescription, AuditResult } from \"../../types\";\nimport { v4 as uuidv4 } from 'uuid';\nimport { GraphqlServicePost, AuditLogM } from \"../../graphql\";\nimport { auditLogDataFormat, extractEventData } from \"../../utils/eventData\";\n\nexport const todoItemUpdatedEvent = async (app: Application): Promise<void> => {\n    app.post(\"/todo_item_updated\", async (req: Request, res: Response) => {\n        if (Object.keys(req.body).length > 0) {\n            try {\n                const {\n                    operation_name,\n                    table_name,\n                    event_name,\n                    update_event_data_prev,\n                    update_event_data_next\n                } = extractEventData(req.body);\n\n                if (operation_name === \"UPDATE\") {\n                    if (update_event_data_prev.title !== update_event_data_next.title && update_event_data_prev.completed !== update_event_data_next.completed) {\n                        const jsonAuditLogFormat = {\n                            ...auditLogDataFormat(\n                                update_event_data_next,\n                                operation_name,\n                                event_name,\n                                table_name),\n                            id: update_event_data_next.id,\n                            updated_field: {\n                                title: update_event_data_next.title,\n                                completed: update_event_data_next.completed\n                            }\n                        } as AuditLogDescription;\n\n                        const audit_log_data = await GraphqlServicePost({ description: JSON.stringify(jsonAuditLogFormat), id: uuidv4() }, AuditLogM) as AuditResult;\n\n                        audit_log_data.data?.insert_audit?.affected_rows === 1 ? res.sendStatus(200) : res.sendStatus(400);\n                    } else if (update_event_data_prev.title !== update_event_data_next.title) {\n                        const jsonAuditLogFormat = {\n                            ...auditLogDataFormat(\n                                update_event_data_next,\n                                operation_name,\n                                event_name,\n                                table_name),\n                            id: update_event_data_next.id,\n                            updated_field: {\n                                title: update_event_data_next.title\n                            }\n                        } as AuditLogDescription;\n\n                        const audit_log_data = await GraphqlServicePost({ description: JSON.stringify(jsonAuditLogFormat), id: uuidv4() }, AuditLogM) as AuditResult;\n\n                        audit_log_data.data?.insert_audit?.affected_rows === 1 ? res.sendStatus(200) : res.sendStatus(400);\n                    } else {\n                        const jsonAuditLogFormat = {\n                            ...auditLogDataFormat(\n                                update_event_data_next,\n                                operation_name,\n                                event_name,\n                                table_name),\n                            id: update_event_data_next.id,\n                            updated_field: {\n                                completed: update_event_data_next.completed\n                            }\n                        } as AuditLogDescription;\n\n                        const audit_log_data = await GraphqlServicePost({ description: JSON.stringify(jsonAuditLogFormat), id: uuidv4() }, AuditLogM) as AuditResult;\n\n                        audit_log_data.data?.insert_audit?.affected_rows === 1 ? res.sendStatus(200) : res.sendStatus(400);\n                    }\n                } else {\n                    res.sendStatus(400);\n                }\n            } catch (error) {\n                res.sendStatus(400);\n            }\n        } else {\n            res.sendStatus(400);\n        }\n    });\n}"]}